{% extends "layout.html" %}
{% block navigation_top %}
    <div class="topnavtitle">Settings</div>
{% endblock %}
{% block body %}
    <script>
        window.toggle_main_nav("leftnav_settings");
    </script>

    <div ng-app="Settings">
        <div ng-controller="Main as main">
            <form name="settingsForm" ng-submit="main.save()">
                <div class="configuration_row row">
                    <div class="col-lg-4">
                        <div class="subtitle">Cloud Provider Settings</div>
                        <div class="subtext">
                            Configure general cloud provider settings.
                        </div>
                    </div>

                    <div class="col-lg-8">
                        <div class="form-group">
                            <label>Type</label>
                            <select ng-model="main.settings.Type" class="form-control">
                                <option>AWS</option>
                                <option>TEST</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>MinInstances</label>
                            <input ng-model="main.settings.MinInstances" type="number" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>MaxInstances</label>
                            <input type="number" class="form-control" ng-model="main.settings.MaxInstances">
                        </div>
                    </div>
                </div>
                <div class="configuration_row row">
                    <div class="col-lg-4">
                        <div class="subtitle">Amazon Configuration</div>
                        <div class="subtext">
                            Configure amazon aws settings.
                        </div>
                    </div>

                    <div class="col-lg-8">
                        <div class="form-group">
                            <label>Key</label>
                            <input type="text" class="form-control" ng-model="main.settings.AWSConfiguration.Key">
                        </div>
                        <div class="form-group">
                            <label>Secret</label>
                            <input type="text" class="form-control" ng-model="main.settings.AWSConfiguration.Secret">
                        </div>
                        <div class="form-group">
                            <label>Region</label>
                            <input type="text" class="form-control" ng-model="main.settings.AWSConfiguration.Region">
                        </div>
                        <div class="form-group">
                            <label>AMI</label>
                            <input type="text" class="form-control" ng-model="main.settings.AWSConfiguration.AMI">
                        </div>
                        <div class="form-group">
                            <label>SecurityGroupId</label>
                            <input type="text" class="form-control" ng-model="main.settings.AWSConfiguration.SecurityGroupId">
                        </div>
                    </div>
                </div>
                <br>
                <button type="submit" class="btn btn-default">Save Settings</button>
            </form>

        <script>
                angular.module("Settings", []).controller("Main", ["$http", function ($http) {
                    var self = this;
                    self.settings = {};

                    var get_settings = function(){
                        return $http.get("/ajax/settings").then(
                                function(response){
                                    self.settings = response.data
                                }, function(err){
                                    console.log("err")
                                }
                        )
                    };
                    get_settings();
                    self.save = function(){
                        $http.post("/ajax/settings", self.settings).then(function(response){
                            get_settings();
                        });
                    }
                }]);
        </script>
        </div>
    </div>
{% endblock %}
